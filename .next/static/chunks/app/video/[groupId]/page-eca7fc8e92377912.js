(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[881],{30918:function(e,t,n){Promise.resolve().then(n.bind(n,35250))},25431:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(57437);function a(e){let{name:t,classes:n}=e;return(0,r.jsx)("div",{className:"flex items-center justify-center  ".concat((e=>{let t=["bg-blue-500","bg-green-500","bg-red-500","bg-yellow-500","bg-indigo-500","bg-pink-500","bg-purple-500","bg-teal-500","bg-cyan-500","bg-orange-500"],n=e.split("").reduce((e,t)=>e+t.charCodeAt(0),0),r=n%t.length;return t[r]})(t)," text-white rounded-full border-box ").concat(n),children:(0,r.jsx)("p",{children:t.split(" ")[0][0]+t.split(" ")[1][0]})})}n(2265)},26261:function(e,t,n){"use strict";n.r(t),n.d(t,{SocketContext:function(){return c},SocketProvider:function(){return o}});var r=n(57437),a=n(82749),l=n(2265),s=n(63388);let c=(0,l.createContext)(null),i=[{url:"stun:global.stun.twilio.com:3478"},{url:"turn:global.turn.twilio.com:3478?transport=udp",username:"a939e485500fe0ea3ed2f216929f5a3f9bcb71b7ae47c0d70d3178eb61a47aaf",credential:"ZQStZHd9+N0rq5pjVxRmO0UaycAbbA/m+/XerXQ3RRY="},{url:"turn:global.turn.twilio.com:3478?transport=tcp",username:"a939e485500fe0ea3ed2f216929f5a3f9bcb71b7ae47c0d70d3178eb61a47aaf",credential:"ZQStZHd9+N0rq5pjVxRmO0UaycAbbA/m+/XerXQ3RRY="},{url:"turn:global.turn.twilio.com:443?transport=tcp",username:"a939e485500fe0ea3ed2f216929f5a3f9bcb71b7ae47c0d70d3178eb61a47aaf",credential:"ZQStZHd9+N0rq5pjVxRmO0UaycAbbA/m+/XerXQ3RRY="}];function o(e){let{children:t}=e,[o,d]=(0,l.useState)(null),[u,f]=(0,l.useState)(null),{data:g}=(0,a.useSession)();return(0,l.useEffect)(()=>{if(g){let e=(0,s.io)("".concat("https://workspace-api-f8rx.onrender.com"),{transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(null==g?void 0:g.authToken)}}}});new Promise(t=>{e.on("connect",()=>{t(e),n.e(42).then(n.bind(n,67900)).then(t=>{let{default:n}=t,r=new n(e.id,{config:{iceServers:i}});d(e),f(r)})})})}},[null==g?void 0:g.authToken]),(0,r.jsx)(c.Provider,{value:{socket:o,peer:u},children:t})}},35250:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(57437),a=n(2265),l=n(26261),s=n(24033),c=n(82749),i=n(67247),o=n(3666),d=n(25431),u=n(16691),f=n.n(u);let g={width:{min:1280},height:{min:720}},h={video:{displaySurface:"window"},audio:!1},m=e=>{let{stream:t}=e,n=a.createRef(),[l,s]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{n.current&&(n.current.srcObject=t.stream),t.stream.getVideoTracks().forEach(e=>{e.onmute=()=>{console.log("Frozen video stream detected!"),s(!1)}}),t.stream.getAudioTracks().forEach(e=>{e.onmute=()=>{console.log("Frozen video stream detected!"),s(!1)}})},[t,n]),(0,r.jsxs)(r.Fragment,{children:[l&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center ",children:[(0,r.jsx)("div",{style:{borderRadius:"10px",overflow:"hidden",zIndex:"1"},className:"w-2/3 sm:w-4/5 md:w-96  xl:w-200",children:(0,r.jsx)("video",{style:{height:"100%",width:"100%",objectFit:"cover"},ref:n,autoPlay:!0})}),(0,r.jsx)("p",{className:"",children:t.metadata.name})]})," "]})};function x(e){let{params:t}=e,[n,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{u(window.navigator)},["object"]);let[x,b]=(0,a.useState)(null),[v,p]=(0,a.useState)(!1),[j,w]=(0,a.useState)(!0),[y,k]=(0,a.useState)(!1),S=(0,a.useRef)(),N=(0,a.useRef)(),I=(0,a.useRef)(),{data:C}=(0,c.useSession)(),R=(0,s.useRouter)(),[A,O]=(0,a.useState)([]),E=(0,a.useRef)(A),T=async function(e){E.current=e,O(e)},[z,V]=(0,a.useState)(!1),[M,U]=(0,a.useState)([]),Z=(0,a.useRef)(),D=(0,a.useRef)(M),F=async function(e){D.current.find(t=>t.stream.id==e.stream.id)||(D.current=[...D.current,e],U(t=>[...t,e]))},{socket:P,peer:_}=(0,a.useContext)(l.SocketContext),[Q,X]=(0,a.useState)(null),[q,H]=(0,a.useState)(null);async function W(e,t){(!1!=e||!1!=t)&&n.mediaDevices.getUserMedia({video:e&&g,audio:!0}).then(e=>{e.getAudioTracks()[0].enabled=t,Z.current.srcObject=e,T(e),q.forEach(t=>{t.clientId!=P.id&&_.call(t.clientId,e,{metadata:{name:null==C?void 0:C.user.name,returnVideo:!1}})})})}async function Y(){try{let e=E.current.getTracks();e.forEach(function(e){e.stop()}),T(null),(e=null==x?void 0:x.getTracks()).forEach(function(e){e.stop()}),b(null)}catch(e){}}(0,a.useEffect)(()=>{if(!P||!_)return;_.on("call",async e=>{console.log("call",e);let t=E.current;e.metadata.returnVideo?(Z.current.srcObject=t,e.answer(t)):e.answer(),e.on("stream",t=>{F({stream:t,metadata:e.metadata})})});let e=e=>{let{usersOnline:t,callStatus:n}=e;X(t),H(n)};return console.log("getting users :"),P.emit("usersOnline",{groupId:t.groupId},e),P.on("usersOnline".concat(t.groupId),e),P.on("callStatus".concat(t.groupId),e=>{console.log("received callstatus",e),H(e)}),()=>{P.off("callStatus".concat(t.groupId)),P.off("usersOnline".concat(t.groupId)),_.off("call")}},[null==P?void 0:P.id,_]);let B=async function(){V(!0),P.emit("acceptCall",{groupId:t.groupId}),n.mediaDevices.getUserMedia({video:g,audio:!0}).then(e=>{e.getAudioTracks()[0].enabled=y,Z.current.srcObject=e,T(e),console.log("calling to ...",q),q.forEach(t=>{console.log("calling",t.clientId,"now");let n=_.call(t.clientId,e,{metadata:{name:null==C?void 0:C.user.name,returnVideo:!0}});n.on("stream",e=>{console.log("stream received",e),F({stream:e,metadata:{name:t.name}})})})})},G=async function(){var e;await Y(),w(!0),p(!0),N.current=null===(e=S.current)||void 0===e?void 0:e.getContext("2d"),n.mediaDevices.getUserMedia({video:g,audio:!1}).then(e=>{b(e),I.current.srcObject=e,r()});let t=new i.SelfieSegmentation({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(e)});t.setOptions({modelSelection:1,selfieMode:!1}),t.onResults(J);let r=async()=>{var e;(null===(e=I.current)||void 0===e?void 0:e.videoWidth)&&await t.send({image:I.current}),requestAnimationFrame(r)},a=S.current.captureStream(),l=await n.mediaDevices.getUserMedia({audio:!0}),s=new MediaStream;a.getVideoTracks().forEach(e=>{s.addTrack(e)}),l.getAudioTracks().forEach(e=>{s.addTrack(e)}),Z.current.srcObject=s,T(s),s.getAudioTracks()[0].enabled=y,q.forEach(e=>{console.log("calling",e.clientId,"now"),e.clientId!=P.id&&_.call(e.clientId,s,{metadata:{name:null==C?void 0:C.user.name,returnVideo:!1}})})},J=e=>{N.current.save(),N.current.clearRect(0,0,S.current.width,S.current.height),N.current.drawImage(e.segmentationMask,0,0,S.current.width,S.current.height),N.current.globalCompositeOperation="source-out",N.current.fillStyle="#000923",N.current.fillRect(0,0,S.current.width,S.current.height),N.current.globalCompositeOperation="destination-atop",N.current.drawImage(e.image,0,0,S.current.width,S.current.height),N.current.restore()},K=async()=>{V(!0),w(!0);let e=await n.mediaDevices.getUserMedia({video:!!j&&g,audio:!0});e.getAudioTracks()[0].enabled=y,Z.current.srcObject=e,T(e),P.emit("startCall",{groupId:t.groupId})},L=async function(){w(!1),p(!1),Y(),W(!1,y)};async function $(){w(!0),Y(),W(!0,y)}async function ee(){let e=await n.mediaDevices.getDisplayMedia(h);q.forEach(t=>{console.log("calling",t.clientId,"now"),t.clientId!=P.id&&_.call(t.clientId,e,{metadata:{name:null==C?void 0:C.user.name,returnVideo:!1}})})}async function et(){V(!1),P.emit("endCall",{groupId:t.groupId}),Y(),R.push("/group/".concat(t.groupId))}async function en(){k(!1),E.current&&(E.current.getAudioTracks()[0].enabled=!1)}async function er(){k(!0),E.current.getAudioTracks()[0]?E.current.getAudioTracks()[0].enabled=!0:v?G():W(!1,!0)}return console.log("callStatus",q),(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("h1",{children:"Wait"}),children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen gap-5 overflow-y-scroll",children:[(0,r.jsxs)("div",{className:"",children:[(0,r.jsx)("video",{hidden:!0,autoPlay:!0,ref:I}),(0,r.jsx)("canvas",{hidden:!0,ref:S,width:1280,height:720})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-5 items-center justify-center",children:D.current.map((e,t)=>(0,r.jsx)(m,{stream:e},t))}),!z&&q&&0!=q.length&&(0,r.jsxs)("div",{className:"flex items-center flex-col gap-5",children:[(0,r.jsx)("p",{className:"text-xl text-bold",children:"In call"}),(0,r.jsx)("div",{className:"flex flex-col  gap-4 ",children:null==q?void 0:q.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(d.Z,{classes:"w-12 h-12",name:e.name}),(0,r.jsx)("div",{children:(0,r.jsx)("p",{children:e.name})})]},e.email))}),(0,r.jsx)(o.z,{onClick:B,children:"Accept Call"})]}),!z&&(!q||0==q.length)&&(0,r.jsxs)("div",{className:"flex flex-col items-center gap-5",children:[(0,r.jsx)("p",{className:"text-xl text-bold",children:"Users Online"}),null==Q?void 0:Q.map(e=>(0,r.jsxs)("div",{className:"w-full flex items-center gap-1",children:[(0,r.jsx)(d.Z,{classes:"w-12 h-12",name:e.name}),(0,r.jsx)("div",{children:(0,r.jsx)("p",{children:e.name})})]},e.email)),(0,r.jsx)(o.z,{onClick:K,children:"Start Call"})]}),z&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"w-full sm:flex-row flex-col flex gap-5 items-center justify-center",children:[(0,r.jsx)("video",{className:"".concat(j?"":"hidden"," rounded-full shadow-lg  w-full h-full object-cover "),muted:!0,style:{height:"150px",width:"150px"},ref:Z,autoPlay:!0,playsInline:!0}),(0,r.jsxs)("div",{className:"flex items-center gap-5 flex-wrap justify-center",children:[j?(0,r.jsxs)(o.z,{className:"bg-blue-500 rounded-full hover:bg-blue-400",onClick:L,children:[(0,r.jsx)(f(),{src:"/video-on.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})," "]}):(0,r.jsx)(o.z,{className:"bg-red-500 rounded-full hover:bg-red-400",onClick:$,children:(0,r.jsx)(f(),{src:"/video-off.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})}),y?(0,r.jsxs)(o.z,{className:"bg-blue-500 rounded-full hover:bg-blue-400",onClick:en,children:[(0,r.jsx)(f(),{src:"/mic-on.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})," "]}):(0,r.jsxs)(o.z,{className:"bg-red-500 rounded-full hover:bg-red-400",onClick:er,children:[(0,r.jsx)(f(),{src:"/mic-off.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})," "]}),j&&!v&&(0,r.jsxs)(o.z,{className:"hidden sm:flex bg-blue-500 rounded-full hover:bg-blue-400",onClick:G,children:[(0,r.jsx)(f(),{src:"/background-remove.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})," "]}),(0,r.jsxs)(o.z,{className:"hidden sm:flex bg-gray-600 rounded-full hover:bg-gray-500",onClick:ee,children:[" ",(0,r.jsx)(f(),{src:"/share-screen.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})," "]}),(0,r.jsxs)(o.z,{className:"bg-red-500 rounded-full hover:bg-red-400 px-8",onClick:et,children:[(0,r.jsx)(f(),{src:"/end-call.png",alt:"",width:"30",height:"30",style:{filter:"brightness(0) invert(1)"}})," "]})]})]})})]})})}},70306:function(e,t,n){"use strict";n.d(t,{cn:function(){return l}});var r=n(57042),a=n(23986);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m)((0,r.W)(t))}},3666:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var r=n(57437),a=n(2265),l=n(67256),s=n(96061),c=n(70306);let i=(0,s.j)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,t)=>{let{className:n,variant:a,size:s,asChild:o=!1,...d}=e,u=o?l.g7:"button";return(0,r.jsx)(u,{className:(0,c.cn)(i({variant:a,size:s,className:n})),ref:t,...d})});o.displayName="Button"}},function(e){e.O(0,[996,649,691,388,860,971,361,744],function(){return e(e.s=30918)}),_N_E=e.O()}]);