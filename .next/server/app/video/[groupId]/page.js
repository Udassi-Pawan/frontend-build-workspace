(() => {
var exports = {};
exports.id = 881;
exports.ids = [881];
exports.modules = {

/***/ 18038:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react");

/***/ }),

/***/ 98704:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-dom/server-rendering-stub");

/***/ }),

/***/ 97897:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react-server-dom-webpack/client");

/***/ }),

/***/ 56786:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/react/jsx-runtime");

/***/ }),

/***/ 5868:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/app-render");

/***/ }),

/***/ 41844:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/get-segment-param");

/***/ }),

/***/ 96624:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/future/helpers/interception-routes");

/***/ }),

/***/ 75281:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/future/route-modules/route-module");

/***/ }),

/***/ 57085:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/app-router-context");

/***/ }),

/***/ 1830:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/get-img-props");

/***/ }),

/***/ 20199:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/hash");

/***/ }),

/***/ 66864:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/head");

/***/ }),

/***/ 86819:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/head-manager-context");

/***/ }),

/***/ 39569:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/hooks-client-context");

/***/ }),

/***/ 52210:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/image-config");

/***/ }),

/***/ 35359:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/image-config-context");

/***/ }),

/***/ 17160:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router-context");

/***/ }),

/***/ 30893:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/add-path-prefix");

/***/ }),

/***/ 12336:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/format-url");

/***/ }),

/***/ 17887:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/handle-smooth-scroll");

/***/ }),

/***/ 98735:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/is-bot");

/***/ }),

/***/ 60120:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/is-local-url");

/***/ }),

/***/ 68231:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/parse-path");

/***/ }),

/***/ 54614:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/path-has-prefix");

/***/ }),

/***/ 53750:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/remove-trailing-slash");

/***/ }),

/***/ 70982:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/resolve-href");

/***/ }),

/***/ 79618:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/server-inserted-html");

/***/ }),

/***/ 78423:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/utils");

/***/ }),

/***/ 98658:
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/utils/warn-once");

/***/ }),

/***/ 32081:
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ 6113:
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ 82361:
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ 57147:
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ 13685:
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ 95687:
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ 41808:
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ 22037:
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ 71017:
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ 12781:
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ 24404:
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ 76224:
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ 57310:
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ 73837:
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ 59796:
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ 30533:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GlobalError: () => (/* reexport safe */ _home_udassi_Documents_Fullstack_workspace_app_global_error_tsx__WEBPACK_IMPORTED_MODULE_2__.ZP),
/* harmony export */   __next_app__: () => (/* binding */ __next_app__),
/* harmony export */   originalPathname: () => (/* binding */ originalPathname),
/* harmony export */   pages: () => (/* binding */ pages),
/* harmony export */   routeModule: () => (/* binding */ routeModule),
/* harmony export */   tree: () => (/* binding */ tree)
/* harmony export */ });
/* harmony import */ var next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7262);
/* harmony import */ var next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(19513);
/* harmony import */ var _home_udassi_Documents_Fullstack_workspace_app_global_error_tsx__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(44452);
/* harmony import */ var next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(12502);
/* harmony import */ var next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__);
/* harmony reexport (unknown) */ var __WEBPACK_REEXPORT_OBJECT__ = {};
/* harmony reexport (unknown) */ for(const __WEBPACK_IMPORT_KEY__ in next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__) if(["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) __WEBPACK_REEXPORT_OBJECT__[__WEBPACK_IMPORT_KEY__] = () => next_dist_server_app_render_entry_base__WEBPACK_IMPORTED_MODULE_3__[__WEBPACK_IMPORT_KEY__]
/* harmony reexport (unknown) */ __webpack_require__.d(__webpack_exports__, __WEBPACK_REEXPORT_OBJECT__);
// @ts-ignore this need to be imported from next/dist to be external


const AppPageRouteModule = next_dist_server_future_route_modules_app_page_module__WEBPACK_IMPORTED_MODULE_0__.AppPageRouteModule;
// We inject the tree and pages here so that we can use them in the route
// module.
const tree = {
        children: [
        '',
        {
        children: [
        'video',
        {
        children: [
        '[groupId]',
        {
        children: ['__PAGE__', {}, {
          page: [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 28998)), "/home/udassi/Documents/Fullstack/workspace/app/video/[groupId]/page.tsx"],
          
        }]
      },
        {
          
          
        }
      ]
      },
        {
          
          metadata: {
    icon: [(async (props) => (await Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 85080))).default(props))],
    apple: [],
    openGraph: [],
    twitter: [],
    manifest: undefined
  }
        }
      ]
      },
        {
          'layout': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 1115)), "/home/udassi/Documents/Fullstack/workspace/app/layout.tsx"],
'not-found': [() => Promise.resolve(/* import() eager */).then(__webpack_require__.t.bind(__webpack_require__, 95493, 23)), "next/dist/client/components/not-found-error"],
          metadata: {
    icon: [(async (props) => (await Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 85080))).default(props))],
    apple: [],
    openGraph: [],
    twitter: [],
    manifest: undefined
  }
        }
      ]
      }.children;
const pages = ["/home/udassi/Documents/Fullstack/workspace/app/video/[groupId]/page.tsx"];

// @ts-expect-error - replaced by webpack/turbopack loader

const __next_app_require__ = __webpack_require__
const __next_app_load_chunk__ = () => Promise.resolve()
const originalPathname = "/video/[groupId]/page";
const __next_app__ = {
    require: __next_app_require__,
    loadChunk: __next_app_load_chunk__
};

// Create and export the route module that will be consumed.
const routeModule = new AppPageRouteModule({
    definition: {
        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_PAGE,
        page: "/video/[groupId]/page",
        pathname: "/video/[groupId]",
        // The following aren't used in production.
        bundlePath: "",
        filename: "",
        appPaths: []
    },
    userland: {
        loaderTree: tree
    }
});

//# sourceMappingURL=app-page.js.map

/***/ }),

/***/ 15995:
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

Promise.resolve(/* import() eager */).then(__webpack_require__.bind(__webpack_require__, 21039))

/***/ }),

/***/ 47915:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Z: () => (/* binding */ Avatar)
/* harmony export */ });
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(56786);
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(18038);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);


function Avatar({ name, classes }) {
    const generateColor = (str)=>{
        const colors = [
            "bg-blue-500",
            "bg-green-500",
            "bg-red-500",
            "bg-yellow-500",
            "bg-indigo-500",
            "bg-pink-500",
            "bg-purple-500",
            "bg-teal-500",
            "bg-cyan-500",
            "bg-orange-500"
        ];
        const charCodeSum = str.split("").reduce((acc, char)=>acc + char.charCodeAt(0), 0);
        const colorIndex = charCodeSum % colors.length;
        return colors[colorIndex];
    };
    return /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("div", {
        className: `flex items-center justify-center  ${generateColor(name)} text-white rounded-full border-box ${classes}`,
        children: /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("p", {
            children: name.split(" ")[0][0] + name.split(" ")[1][0]
        })
    });
}


/***/ }),

/***/ 21039:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Page)
/* harmony export */ });
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(56786);
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(18038);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _components_SocketProvider__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(81420);
/* harmony import */ var next_navigation__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(57114);
/* harmony import */ var next_navigation__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_navigation__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(74284);
/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_auth_react__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _mediapipe_selfie_segmentation__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(85208);
/* harmony import */ var _mediapipe_selfie_segmentation__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_mediapipe_selfie_segmentation__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(23094);
/* harmony import */ var _app_components_Avatar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(47915);
/* harmony import */ var next_image__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(52451);
/* harmony import */ var next_image__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_image__WEBPACK_IMPORTED_MODULE_7__);
/* __next_internal_client_entry_do_not_use__ default auto */ 








const videoConstraints = {
    width: {
        min: 1280
    },
    height: {
        min: 720
    }
};
const displayMediaOptions = {
    video: {
        displaySurface: "window"
    },
    audio: false
};
const Video = ({ stream })=>{
    const localVideo = /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_1___default().createRef();
    const [show, setShow] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(true);
    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{
        if (localVideo.current) localVideo.current.srcObject = stream.stream;
        stream.stream.getVideoTracks().forEach((videoTrack)=>{
            videoTrack.onmute = ()=>{
                console.log("Frozen video stream detected!");
                setShow(false);
            };
        });
        stream.stream.getAudioTracks().forEach((videoTrack)=>{
            videoTrack.onmute = ()=>{
                console.log("Frozen video stream detected!");
                setShow(false);
            };
        });
    }, [
        stream,
        localVideo
    ]);
    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, {
        children: [
            show && /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                className: "flex flex-col items-center justify-center ",
                children: [
                    /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("div", {
                        style: {
                            borderRadius: "10px",
                            overflow: "hidden",
                            zIndex: "1"
                        },
                        className: "w-2/3 sm:w-4/5 md:w-96  xl:w-200",
                        children: /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("video", {
                            style: {
                                height: "100%",
                                width: "100%",
                                objectFit: "cover"
                            },
                            ref: localVideo,
                            autoPlay: true
                        })
                    }),
                    /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("p", {
                        className: "",
                        children: stream.metadata.name
                    })
                ]
            }),
            " "
        ]
    });
};
function Page({ params }) {
    const [myNavigator, setMyNavigator] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);
    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{
        if (true) setMyNavigator(window.navigator);
    }, [
        "undefined"
    ]);
    const [streamForMediapipe, setStreamForMediapipe] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);
    const [backgroundBlur, setBackgroundBlur] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);
    const [myVideo, setMyVideo] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(true);
    const [myAudio, setMyAudio] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);
    const canvasRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)();
    const contextRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)();
    const inputVideoRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)();
    const { data: session } = (0,next_auth_react__WEBPACK_IMPORTED_MODULE_4__.useSession)();
    const router = (0,next_navigation__WEBPACK_IMPORTED_MODULE_3__.useRouter)();
    const [myStreams, setMyStreams] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]);
    const myStreamsUpdated = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(myStreams);
    const setMyStreamsUpdated = async function(data) {
        myStreamsUpdated.current = data;
        setMyStreams(data);
    };
    const [onCall, setOnCall] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);
    const [peers, setPeers] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]);
    const userVideo = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)();
    const peersUpdated = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(peers);
    const setPeersUpdated = async function(data) {
        if (peersUpdated.current.find((el)=>el.stream.id == data.stream.id)) return;
        peersUpdated.current = [
            ...peersUpdated.current,
            data
        ];
        setPeers((users)=>[
                ...users,
                data
            ]);
    };
    let { socket, peer } = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(_components_SocketProvider__WEBPACK_IMPORTED_MODULE_2__.SocketContext);
    const [usersOnline, setUsersOnline] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);
    const [thisGroupCallStatus, setThisGroupCallStatus] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);
    async function callEverybody(video, audio) {
        if (video == false && audio == false) return;
        myNavigator.mediaDevices.getUserMedia({
            video: video && videoConstraints,
            audio: true
        }).then((_stream)=>{
            _stream.getAudioTracks()[0].enabled = audio;
            userVideo.current.srcObject = _stream;
            setMyStreamsUpdated(_stream);
            thisGroupCallStatus.forEach((user)=>{
                if (user.clientId == socket.id) return;
                const call = peer.call(user.clientId, _stream, {
                    metadata: {
                        name: session?.user.name,
                        returnVideo: false
                    }
                });
            });
        });
    }
    async function stopStream() {
        try {
            let tracks = myStreamsUpdated.current.getTracks();
            tracks.forEach(function(track) {
                track.stop();
            });
            setMyStreamsUpdated(null);
            tracks = streamForMediapipe?.getTracks();
            tracks.forEach(function(track) {
                track.stop();
            });
            setStreamForMediapipe(null);
        } catch (e) {}
    }
    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{
        if (!socket || !peer) return;
        peer.on("call", async (mediaConnection)=>{
            console.log("call", mediaConnection);
            const _stream = myStreamsUpdated.current;
            if (mediaConnection.metadata.returnVideo) {
                userVideo.current.srcObject = _stream;
                mediaConnection.answer(_stream);
            } else mediaConnection.answer();
            mediaConnection.on("stream", (remoteStream)=>{
                setPeersUpdated({
                    stream: remoteStream,
                    metadata: mediaConnection.metadata
                });
            });
        });
        const userOnlineHandler = ({ usersOnline, callStatus })=>{
            setUsersOnline(usersOnline);
            setThisGroupCallStatus(callStatus);
        };
        console.log("getting users :");
        socket.emit("usersOnline", {
            groupId: params.groupId
        }, userOnlineHandler);
        socket.on(`usersOnline${params.groupId}`, userOnlineHandler);
        socket.on(`callStatus${params.groupId}`, (_callStatus)=>{
            console.log("received callstatus", _callStatus);
            setThisGroupCallStatus(_callStatus);
        });
        return ()=>{
            socket.off(`callStatus${params.groupId}`);
            socket.off(`usersOnline${params.groupId}`);
            peer.off("call");
        };
    }, [
        socket?.id,
        peer
    ]);
    const acceptHandler = async function() {
        setOnCall(true);
        socket.emit("acceptCall", {
            groupId: params.groupId
        });
        myNavigator.mediaDevices.getUserMedia({
            video: videoConstraints,
            audio: true
        }).then((_stream)=>{
            _stream.getAudioTracks()[0].enabled = myAudio;
            userVideo.current.srcObject = _stream;
            setMyStreamsUpdated(_stream);
            console.log("calling to ...", thisGroupCallStatus);
            thisGroupCallStatus.forEach((user)=>{
                console.log("calling", user.clientId, "now");
                const call = peer.call(user.clientId, _stream, {
                    metadata: {
                        name: session?.user.name,
                        returnVideo: true
                    }
                });
                call.on("stream", (remoteStream)=>{
                    console.log("stream received", remoteStream);
                    setPeersUpdated({
                        stream: remoteStream,
                        metadata: {
                            name: user.name
                        }
                    });
                });
            });
        });
    };
    const blurBackgroundHandler = async function() {
        await stopStream();
        setMyVideo(true);
        setBackgroundBlur(true);
        contextRef.current = canvasRef.current?.getContext("2d");
        myNavigator.mediaDevices.getUserMedia({
            video: videoConstraints,
            audio: false
        }).then((stream)=>{
            setStreamForMediapipe(stream);
            inputVideoRef.current.srcObject = stream;
            sendToMediaPipe();
        });
        const selfieSegmentation = new _mediapipe_selfie_segmentation__WEBPACK_IMPORTED_MODULE_8__.SelfieSegmentation({
            locateFile: (file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`
        });
        selfieSegmentation.setOptions({
            modelSelection: 1,
            selfieMode: false
        });
        selfieSegmentation.onResults(onResults);
        const sendToMediaPipe = async ()=>{
            if (!inputVideoRef.current?.videoWidth) {
                requestAnimationFrame(sendToMediaPipe);
            } else {
                await selfieSegmentation.send({
                    image: inputVideoRef.current
                });
                requestAnimationFrame(sendToMediaPipe);
            }
        };
        const canvasStream = canvasRef.current.captureStream();
        const audioStream = await myNavigator.mediaDevices.getUserMedia({
            audio: true
        });
        const combinedStream = new MediaStream();
        canvasStream.getVideoTracks().forEach((track)=>{
            combinedStream.addTrack(track);
        });
        audioStream.getAudioTracks().forEach((track)=>{
            combinedStream.addTrack(track);
        });
        userVideo.current.srcObject = combinedStream;
        setMyStreamsUpdated(combinedStream);
        combinedStream.getAudioTracks()[0].enabled = myAudio;
        thisGroupCallStatus.forEach((user)=>{
            console.log("calling", user.clientId, "now");
            if (user.clientId != socket.id) peer.call(user.clientId, combinedStream, {
                metadata: {
                    name: session?.user.name,
                    returnVideo: false
                }
            });
        });
    };
    const onResults = (results)=>{
        contextRef.current.save();
        contextRef.current.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
        contextRef.current.drawImage(results.segmentationMask, 0, 0, canvasRef.current.width, canvasRef.current.height);
        // Only overwrite existing pixels.
        contextRef.current.globalCompositeOperation = "source-out";
        contextRef.current.fillStyle = "#000923";
        // contextRef.current.fillStyle = "#00FF06";
        contextRef.current.fillRect(0, 0, canvasRef.current.width, canvasRef.current.height);
        // Only overwrite missing pixels.
        contextRef.current.globalCompositeOperation = "destination-atop";
        contextRef.current.drawImage(results.image, 0, 0, canvasRef.current.width, canvasRef.current.height);
        contextRef.current.restore();
    // console.log(canvasStream);
    };
    const startHandler = async ()=>{
        setOnCall(true);
        setMyVideo(true);
        const _stream = await myNavigator.mediaDevices.getUserMedia({
            video: myVideo ? videoConstraints : false,
            audio: true
        });
        _stream.getAudioTracks()[0].enabled = myAudio;
        userVideo.current.srcObject = _stream;
        setMyStreamsUpdated(_stream);
        socket.emit("startCall", {
            groupId: params.groupId
        });
    };
    const turnVideoOffHandler = async function() {
        setMyVideo(false);
        setBackgroundBlur(false);
        stopStream();
        callEverybody(false, myAudio);
    };
    async function turnVideoOnHandler() {
        setMyVideo(true);
        stopStream();
        callEverybody(true, myAudio);
    }
    async function shareScreenHandler() {
        const screenStream = await myNavigator.mediaDevices.getDisplayMedia(displayMediaOptions);
        thisGroupCallStatus.forEach((user)=>{
            console.log("calling", user.clientId, "now");
            if (user.clientId == socket.id) return;
            const call = peer.call(user.clientId, screenStream, {
                metadata: {
                    name: session?.user.name,
                    returnVideo: false
                }
            });
        });
    }
    async function endHandler() {
        setOnCall(false);
        socket.emit(`endCall`, {
            groupId: params.groupId
        });
        stopStream();
        router.push(`/group/${params.groupId}`);
    }
    async function turnAudioOffHandler() {
        setMyAudio(false);
        if (myStreamsUpdated.current) myStreamsUpdated.current.getAudioTracks()[0].enabled = false;
    }
    async function turnAudioOnHandler() {
        setMyAudio(true);
        if (myStreamsUpdated.current.getAudioTracks()[0]) myStreamsUpdated.current.getAudioTracks()[0].enabled = true;
        else if (backgroundBlur) blurBackgroundHandler();
        else callEverybody(false, true);
    }
    console.log("callStatus", thisGroupCallStatus);
    return /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((react__WEBPACK_IMPORTED_MODULE_1___default().Suspense), {
        fallback: /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("h1", {
            children: "Wait"
        }),
        children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
            className: "flex flex-col items-center justify-center h-screen gap-5 overflow-y-scroll",
            children: [
                /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                    className: "",
                    children: [
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("video", {
                            hidden: true,
                            autoPlay: true,
                            ref: inputVideoRef
                        }),
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("canvas", {
                            hidden: true,
                            ref: canvasRef,
                            width: 1280,
                            height: 720
                        })
                    ]
                }),
                /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("div", {
                    className: "flex flex-wrap gap-5 items-center justify-center",
                    children: peersUpdated.current.map((stream, index)=>{
                        return /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(Video, {
                            stream: stream
                        }, index);
                    })
                }),
                !onCall && thisGroupCallStatus && thisGroupCallStatus.length != 0 && /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                    className: "flex items-center flex-col gap-5",
                    children: [
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("p", {
                            className: "text-xl text-bold",
                            children: "In call"
                        }),
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("div", {
                            className: "flex flex-col  gap-4 ",
                            children: thisGroupCallStatus?.map((m)=>/*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                                    className: "flex items-center gap-1",
                                    children: [
                                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(_app_components_Avatar__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z, {
                                            classes: "w-12 h-12",
                                            name: m.name
                                        }),
                                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("div", {
                                            children: /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("p", {
                                                children: m.name
                                            })
                                        })
                                    ]
                                }, m.email))
                        }),
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                            onClick: acceptHandler,
                            children: "Accept Call"
                        })
                    ]
                }),
                !onCall && (!thisGroupCallStatus || thisGroupCallStatus.length == 0) && /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                    className: "flex flex-col items-center gap-5",
                    children: [
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("p", {
                            className: "text-xl text-bold",
                            children: "Users Online"
                        }),
                        usersOnline?.map((m)=>/*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                                className: "w-full flex items-center gap-1",
                                children: [
                                    /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(_app_components_Avatar__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .Z, {
                                        classes: "w-12 h-12",
                                        name: m.name
                                    }),
                                    /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("div", {
                                        children: /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("p", {
                                            children: m.name
                                        })
                                    })
                                ]
                            }, m.email)),
                        /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                            onClick: startHandler,
                            children: "Start Call"
                        })
                    ]
                }),
                onCall && /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, {
                    children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                        className: "w-full sm:flex-row flex-col flex gap-5 items-center justify-center",
                        children: [
                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx("video", {
                                className: `${myVideo ? "" : "hidden"} rounded-full shadow-lg  w-full h-full object-cover `,
                                muted: true,
                                style: {
                                    height: "150px",
                                    width: "150px"
                                },
                                ref: userVideo,
                                autoPlay: true,
                                playsInline: true
                            }),
                            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div", {
                                className: "flex items-center gap-5 flex-wrap justify-center",
                                children: [
                                    !myVideo ? /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "bg-red-500 rounded-full hover:bg-red-400",
                                        onClick: turnVideoOnHandler,
                                        children: /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                            src: "/video-off.png",
                                            alt: "",
                                            width: "30",
                                            height: "30",
                                            style: {
                                                filter: "brightness(0) invert(1)"
                                            }
                                        })
                                    }) : /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "bg-blue-500 rounded-full hover:bg-blue-400",
                                        onClick: turnVideoOffHandler,
                                        children: [
                                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                                src: "/video-on.png",
                                                alt: "",
                                                width: "30",
                                                height: "30",
                                                style: {
                                                    filter: "brightness(0) invert(1)"
                                                }
                                            }),
                                            " "
                                        ]
                                    }),
                                    !myAudio ? /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "bg-red-500 rounded-full hover:bg-red-400",
                                        onClick: turnAudioOnHandler,
                                        children: [
                                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                                src: "/mic-off.png",
                                                alt: "",
                                                width: "30",
                                                height: "30",
                                                style: {
                                                    filter: "brightness(0) invert(1)"
                                                }
                                            }),
                                            " "
                                        ]
                                    }) : /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "bg-blue-500 rounded-full hover:bg-blue-400",
                                        onClick: turnAudioOffHandler,
                                        children: [
                                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                                src: "/mic-on.png",
                                                alt: "",
                                                width: "30",
                                                height: "30",
                                                style: {
                                                    filter: "brightness(0) invert(1)"
                                                }
                                            }),
                                            " "
                                        ]
                                    }),
                                    myVideo && !backgroundBlur && /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "hidden sm:flex bg-blue-500 rounded-full hover:bg-blue-400",
                                        onClick: blurBackgroundHandler,
                                        children: [
                                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                                src: "/background-remove.png",
                                                alt: "",
                                                width: "30",
                                                height: "30",
                                                style: {
                                                    filter: "brightness(0) invert(1)"
                                                }
                                            }),
                                            " "
                                        ]
                                    }),
                                    /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "hidden sm:flex bg-gray-600 rounded-full hover:bg-gray-500",
                                        onClick: shareScreenHandler,
                                        children: [
                                            " ",
                                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                                src: "/share-screen.png",
                                                alt: "",
                                                width: "30",
                                                height: "30",
                                                style: {
                                                    filter: "brightness(0) invert(1)"
                                                }
                                            }),
                                            " "
                                        ]
                                    }),
                                    /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_shardcn_components_ui_button__WEBPACK_IMPORTED_MODULE_5__/* .Button */ .z, {
                                        className: "bg-red-500 rounded-full hover:bg-red-400 px-8",
                                        onClick: endHandler,
                                        children: [
                                            /*#__PURE__*/ react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx((next_image__WEBPACK_IMPORTED_MODULE_7___default()), {
                                                src: "/end-call.png",
                                                alt: "",
                                                width: "30",
                                                height: "30",
                                                style: {
                                                    filter: "brightness(0) invert(1)"
                                                }
                                            }),
                                            " "
                                        ]
                                    })
                                ]
                            })
                        ]
                    })
                })
            ]
        })
    });
}


/***/ }),

/***/ 28998:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   $$typeof: () => (/* binding */ $$typeof),
/* harmony export */   __esModule: () => (/* binding */ __esModule),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var next_dist_build_webpack_loaders_next_flight_loader_module_proxy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(61363);

const proxy = (0,next_dist_build_webpack_loaders_next_flight_loader_module_proxy__WEBPACK_IMPORTED_MODULE_0__.createProxy)(String.raw`/home/udassi/Documents/Fullstack/workspace/app/video/[groupId]/page.tsx`)

// Accessing the __esModule property and exporting $$typeof are required here.
// The __esModule getter forces the proxy target to create the default export
// and the $$typeof value is for rendering logic to determine if the module
// is a client boundary.
const { __esModule, $$typeof } = proxy;
const __default__ = proxy.default;


/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__default__);

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, [587,777,877,647,337,94], () => (__webpack_exec__(30533)));
module.exports = __webpack_exports__;

})();